{% extends "base.html" %}

{% block content %}
<h2>{{ page_title or "Cat√°logo de libros" }}</h2>

<!-- Navegaci√≥n -->
<div style="margin-bottom: 20px; padding: 10px; background-color: #ecf0f1; border-radius: 3px;">
    <a href="/" style="margin-right: 15px;">üè† Inicio</a>
    <a href="/top-rated" style="margin-right: 15px;">‚≠ê M√°s valorados</a>
    <a href="/search" style="margin-right: 15px;">üìö Ver todos</a>
</div>

<!-- Buscador y filtros -->
<form action="/search" method="get" style="margin-bottom: 20px;">
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <input type="text" name="q" placeholder="Buscar por t√≠tulo o autor..." 
               value="{{ search_query or '' }}" 
               style="flex: 1; min-width: 200px; padding: 10px; border: 1px solid #ddd; border-radius: 3px;">
        
        <select name="category" style="padding: 10px; border: 1px solid #ddd; border-radius: 3px;">
            <option value="">Todos los idiomas</option>
            {% for cat in categories %}
            <option value="{{ cat }}" {% if selected_category == cat %}selected{% endif %}>{{ cat }}</option>
            {% endfor %}
        </select>
        
        <button type="submit" style="padding: 10px 20px; background-color: #3498db; color: white; border: none; border-radius: 3px; cursor: pointer;">
            üîç Buscar
        </button>
        
        <a href="/" style="padding: 10px 15px; background-color: #95a5a6; color: white; border-radius: 3px; display: inline-block; text-decoration: none;">
            Limpiar
        </a>
    </div>
</form>

{% if search_query or selected_category %}
<p style="color: #7f8c8d; font-style: italic; margin-bottom: 15px;">
    {% if search_query %}B√∫squeda: "{{ search_query }}"{% endif %}
    {% if selected_category %}Idioma: {{ selected_category }}{% endif %}
</p>
{% endif %}

<!-- Listado de libros -->
{% if books %}
{% if pagination %}
<p style="margin-bottom: 15px; color: #7f8c8d;">
    Mostrando {{ books|length }} libros (p√°gina {{ pagination.page }} de {{ pagination.total_pages }}, total: {{ pagination.total }})
</p>
{% else %}
<p style="margin-bottom: 15px; color: #7f8c8d;">Mostrando {{ books|length }} libros</p>
{% endif %}

<table style="width: 100%; border-collapse: collapse;">
    <thead>
        <tr style="background-color: #ecf0f1;">
            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #bdc3c7;">ID</th>
            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #bdc3c7;">T√≠tulo</th>
            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #bdc3c7;">Autor</th>
            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #bdc3c7;">Idioma/Valoraci√≥n</th>
        </tr>
    </thead>
    <tbody>
        {% for book in books %}
        <tr style="border-bottom: 1px solid #ecf0f1;">
            <td style="padding: 10px;">{{ book.id }}</td>
            <td style="padding: 10px;">
                <a href="/book/{{ book.id }}" style="font-weight: bold;">{{ book.title }}</a>
            </td>
            <td style="padding: 10px;">{{ book.author }}</td>
            <td style="padding: 10px;">{{ book.category }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Paginaci√≥n -->
{% if pagination and pagination.total_pages > 1 %}
<div style="margin-top: 30px; padding: 20px; text-align: center; background-color: #ecf0f1; border-radius: 5px;">
    {% set base_url = url_for(current_route) %}
    {% set query_params = [] %}
    {% if search_query %}{% set _ = query_params.append('q=' + search_query) %}{% endif %}
    {% if selected_category %}{% set _ = query_params.append('category=' + selected_category) %}{% endif %}
    {% set query_string = '&'.join(query_params) %}
    
    {% if pagination.has_prev %}
    <a href="{{ base_url }}?page=1{% if query_string %}&{{ query_string }}{% endif %}" 
       style="padding: 8px 12px; margin: 0 5px; background-color: white; border: 1px solid #bdc3c7; border-radius: 3px; text-decoration: none; color: #2c3e50;">
        ¬´ Primera
    </a>
    <a href="{{ base_url }}?page={{ pagination.page - 1 }}{% if query_string %}&{{ query_string }}{% endif %}" 
       style="padding: 8px 12px; margin: 0 5px; background-color: white; border: 1px solid #bdc3c7; border-radius: 3px; text-decoration: none; color: #2c3e50;">
        ‚Äπ Anterior
    </a>
    {% else %}
    <span style="padding: 8px 12px; margin: 0 5px; background-color: #ecf0f1; border: 1px solid #bdc3c7; border-radius: 3px; color: #95a5a6;">
        ¬´ Primera
    </span>
    <span style="padding: 8px 12px; margin: 0 5px; background-color: #ecf0f1; border: 1px solid #bdc3c7; border-radius: 3px; color: #95a5a6;">
        ‚Äπ Anterior
    </span>
    {% endif %}
    
    <span style="padding: 8px 15px; margin: 0 10px; font-weight: bold; color: #2c3e50;">
        P√°gina {{ pagination.page }} / {{ pagination.total_pages }}
    </span>
    
    {% if pagination.has_next %}
    <a href="{{ base_url }}?page={{ pagination.page + 1 }}{% if query_string %}&{{ query_string }}{% endif %}" 
       style="padding: 8px 12px; margin: 0 5px; background-color: white; border: 1px solid #bdc3c7; border-radius: 3px; text-decoration: none; color: #2c3e50;">
        Siguiente ‚Ä∫
    </a>
    <a href="{{ base_url }}?page={{ pagination.total_pages }}{% if query_string %}&{{ query_string }}{% endif %}" 
       style="padding: 8px 12px; margin: 0 5px; background-color: white; border: 1px solid #bdc3c7; border-radius: 3px; text-decoration: none; color: #2c3e50;">
        √öltima ¬ª
    </a>
    {% else %}
    <span style="padding: 8px 12px; margin: 0 5px; background-color: #ecf0f1; border: 1px solid #bdc3c7; border-radius: 3px; color: #95a5a6;">
        Siguiente ‚Ä∫
    </span>
    <span style="padding: 8px 12px; margin: 0 5px; background-color: #ecf0f1; border: 1px solid #bdc3c7; border-radius: 3px; color: #95a5a6;">
        √öltima ¬ª
    </span>
    {% endif %}
</div>
{% endif %}

{% else %}
<div style="padding: 40px; text-align: center; background-color: #ecf0f1; border-radius: 5px;">
    <p style="font-size: 18px; color: #7f8c8d;">üìö No se encontraron libros</p>
    <a href="/" style="display: inline-block; margin-top: 15px; padding: 10px 20px; background-color: #3498db; color: white; border-radius: 3px; text-decoration: none;">
        Ver cat√°logo completo
    </a>
</div>
{% endif %}
{% endblock %}
